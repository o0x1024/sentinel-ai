# HTTP请求工具错误处理改进

## 改进内容

### 1. 详细的错误分类

HTTP请求工具现在能够识别并提供具体的错误原因：

#### 连接相关错误
- **连接超时**: `请求超时：服务器响应时间过长`
- **连接失败**: `连接失败：无法连接到目标服务器 (http://127.0.0.1/...)`
- **连接被拒绝**: `连接被拒绝：目标端口未开放或服务未启动`
- **网络不可达**: `网络不可达：目标主机无法访问，请检查网络连接和防火墙设置`

#### DNS和域名解析错误
- **DNS解析失败**: `DNS解析失败：无法解析域名，请检查网络连接或域名是否正确`

#### SSL/TLS错误
- **证书验证失败**: `SSL/TLS错误：证书验证失败，可尝试设置verify_ssl为false`

#### 请求格式错误
- **请求格式错误**: `请求格式错误：请检查URL、请求头或请求体格式`
- **重定向错误**: `重定向错误：重定向次数过多或重定向循环`

#### 响应处理错误
- **响应体读取错误**: `响应体读取错误：服务器响应数据格式异常`
- **响应解码错误**: `响应解码错误：无法解析服务器响应内容`

### 2. 参数验证改进

更详细的参数验证错误信息：

```json
{
  "error": "参数错误：URL必须以http://或https://开头，当前URL: ftp://example.com"
}
```

```json
{
  "error": "参数错误：超时时间必须在1-300秒之间，当前值: 500秒"
}
```

### 3. 错误信息传递

错误信息现在会在多个层级传递：

1. **ToolExecutionResult.error**: 包含详细错误描述
2. **output.error**: JSON输出中的错误字段
3. **output.summary.error_details**: 摘要中的错误详情

## 使用示例

### 原始错误输出（改进前）
```json
{
  "error": "error sending request for url (http://127.0.0.1/vulnerabilities/exec/)",
  "success": false,
  "summary": {
    "status": "failed"
  }
}
```

### 改进后的错误输出
```json
{
  "error": "连接被拒绝：目标端口未开放或服务未启动",
  "success": false,
  "summary": {
    "status": "failed",
    "error_details": "连接被拒绝：目标端口未开放或服务未启动"
  }
}
```

## 常见错误场景及解决方案

### 1. 连接被拒绝 (Connection Refused)
**错误信息**: `连接被拒绝：目标端口未开放或服务未启动`

**可能原因**:
- 目标服务未启动
- 端口被防火墙阻止
- 端口号错误

**解决方案**:
- 检查目标服务是否正在运行
- 验证端口号是否正确
- 检查防火墙设置

### 2. DNS解析失败
**错误信息**: `DNS解析失败：无法解析域名，请检查网络连接或域名是否正确`

**可能原因**:
- 域名不存在或拼写错误
- DNS服务器无法访问
- 网络连接问题

**解决方案**:
- 验证域名拼写
- 检查网络连接
- 尝试使用IP地址替代域名

### 3. SSL证书验证失败
**错误信息**: `SSL/TLS错误：证书验证失败，可尝试设置verify_ssl为false`

**可能原因**:
- 自签名证书
- 证书过期
- 证书域名不匹配

**解决方案**:
- 对于测试环境，设置 `verify_ssl: false`
- 更新或重新配置SSL证书
- 使用正确的域名访问

### 4. 请求超时
**错误信息**: `请求超时：服务器响应时间过长`

**可能原因**:
- 服务器响应慢
- 网络延迟高
- 超时设置过短

**解决方案**:
- 增加 `timeout_seconds` 参数值
- 检查网络连接质量
- 优化服务器性能

## 调试建议

1. **查看完整错误信息**: 检查 `error` 和 `summary.error_details` 字段
2. **分析错误类型**: 根据错误分类采取相应的解决措施
3. **逐步排查**: 从网络连接、DNS解析、SSL证书等方面逐一检查
4. **使用简单请求测试**: 先用简单的GET请求测试连通性
5. **检查日志**: 查看详细的执行日志获取更多信息

这些改进使HTTP请求工具的错误处理更加友好和实用，帮助用户快速定位和解决问题。
