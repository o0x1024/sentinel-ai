# ToolResult çŠ¶æ€æ˜¾ç¤ºä¿®å¤

## é—®é¢˜æè¿°

å·¥å…·æ‰§è¡Œç»“æœçš„æ ‡é¢˜æ çŠ¶æ€æ˜¾ç¤ºä¸å®é™…æ‰§è¡Œç»“æœä¸ä¸€è‡´çš„é—®é¢˜ï¼š
- å·¥å…·æ‰§è¡Œå¤±è´¥ï¼ˆ`"success": false`, `"error": "è¯·æ±‚è¶…æ—¶: æœåŠ¡å™¨å“åº”æ—¶é—´è¿‡é•¿"`ï¼‰
- ä½†æ ‡é¢˜æ æ˜¾ç¤º"æˆåŠŸ"çŠ¶æ€

## é—®é¢˜åŸå› 

åœ¨ `useOrderedMessages.ts` çš„ `formatToolResult` æ–¹æ³•ä¸­ï¼ŒçŠ¶æ€åˆ¤æ–­é€»è¾‘ä¸å¤Ÿå¥å£®ï¼š

### åŸå§‹ä»£ç é—®é¢˜
```typescript
if (parsed?.success === false || parsed?.error) {
  isSuccess = false
  // ...
}
```

è¿™ä¸ªåˆ¤æ–­åªè€ƒè™‘äº† `success` å­—æ®µä¸ºå¸ƒå°”å€¼ `false` çš„æƒ…å†µï¼Œä½†å®é™…ä¸Šï¼š
1. JSON åºåˆ—åŒ–/ååºåˆ—åŒ–è¿‡ç¨‹ä¸­å¯èƒ½å°†å¸ƒå°”å€¼è½¬ä¸ºå­—ç¬¦ä¸²
2. ä¸åŒçš„æ•°æ®æºå¯èƒ½ä½¿ç”¨ä¸åŒçš„è¡¨ç¤ºæ–¹å¼ï¼ˆ`"false"`, `0`, `"0"` ç­‰ï¼‰
3. é”™è¯¯å­—æ®µçš„å­˜åœ¨æ€§æ£€æŸ¥ä¸å¤Ÿä¸¥æ ¼

## ä¿®å¤æ–¹æ¡ˆ

### 1. å¢å¼ºçŠ¶æ€åˆ¤æ–­é€»è¾‘

```typescript
// å¤„ç† success å­—æ®µå¯èƒ½æ˜¯å¸ƒå°”å€¼æˆ–å­—ç¬¦ä¸²çš„æƒ…å†µ
const successValue = parsed?.success
const hasError = parsed?.error && parsed.error !== null && parsed.error !== ''

// æ›´å¥å£®çš„å¤±è´¥åˆ¤æ–­é€»è¾‘
const isFailure = successValue === false || 
                 successValue === 'false' || 
                 successValue === "false" ||
                 successValue === 0 ||
                 successValue === '0' ||
                 hasError
```

### 2. æ”¯æŒå¤šç§å¤±è´¥è¡¨ç¤ºæ–¹å¼

- **å¸ƒå°”å€¼**: `false`
- **å­—ç¬¦ä¸²**: `"false"`
- **æ•°å€¼**: `0`
- **å­—ç¬¦ä¸²æ•°å€¼**: `"0"`
- **é”™è¯¯å­—æ®µ**: å­˜åœ¨ä¸”éç©ºçš„ `error` å­—æ®µ

### 3. æ·»åŠ è°ƒè¯•ä¿¡æ¯

```typescript
console.log('ToolResult parsing:', {
  successValue,
  hasError,
  isFailure,
  errorField: parsed?.error
})
```

## æµ‹è¯•ç”¨ä¾‹

### å¤±è´¥æƒ…å†µåº”è¯¥è¢«æ­£ç¡®è¯†åˆ«

```json
// å¸ƒå°”å€¼ false
{"success": false, "error": "è¯·æ±‚è¶…æ—¶"}

// å­—ç¬¦ä¸² "false"
{"success": "false", "error": "è¿æ¥å¤±è´¥"}

// æ•°å€¼ 0
{"success": 0, "error": "ç½‘ç»œé”™è¯¯"}

// å­—ç¬¦ä¸²æ•°å€¼ "0"
{"success": "0", "error": "æœåŠ¡ä¸å¯ç”¨"}

// ä»…æœ‰é”™è¯¯å­—æ®µ
{"error": "æœªçŸ¥é”™è¯¯"}

// ç©ºçš„ success ä½†æœ‰é”™è¯¯
{"success": null, "error": "é…ç½®é”™è¯¯"}
```

### æˆåŠŸæƒ…å†µåº”è¯¥è¢«æ­£ç¡®è¯†åˆ«

```json
// å¸ƒå°”å€¼ true
{"success": true, "result": "æ“ä½œæˆåŠŸ"}

// å­—ç¬¦ä¸² "true"
{"success": "true", "result": "è¯·æ±‚å®Œæˆ"}

// æ•°å€¼ 1
{"success": 1, "result": "æ‰§è¡ŒæˆåŠŸ"}

// æ— é”™è¯¯å­—æ®µ
{"success": true}
```

## æ˜¾ç¤ºæ•ˆæœ

### ä¿®å¤å‰
- æ ‡é¢˜æ : `ğŸ”§ http_request æˆåŠŸ` âŒ (é”™è¯¯æ˜¾ç¤º)
- å†…å®¹: `"success": false, "error": "è¯·æ±‚è¶…æ—¶"`

### ä¿®å¤å
- æ ‡é¢˜æ : `âŒ http_request å¤±è´¥` âœ… (æ­£ç¡®æ˜¾ç¤º)
- å†…å®¹: `"success": false, "error": "è¯·æ±‚è¶…æ—¶"`

## ç›¸å…³æ–‡ä»¶

- `src/composables/useOrderedMessages.ts` - å‰ç«¯çŠ¶æ€è§£æé€»è¾‘
- `src-tauri/src/tools/builtin/http_request.rs` - åç«¯çŠ¶æ€ç”Ÿæˆé€»è¾‘

## æ³¨æ„äº‹é¡¹

1. è¿™ä¸ªä¿®å¤ç¡®ä¿äº†å‰ç«¯èƒ½æ­£ç¡®è§£æå„ç§æ ¼å¼çš„çŠ¶æ€ä¿¡æ¯
2. è°ƒè¯•ä¿¡æ¯ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºï¼Œä¾¿äºæ’æŸ¥é—®é¢˜
3. ä¿®å¤æ˜¯å‘åå…¼å®¹çš„ï¼Œä¸ä¼šå½±å“ç°æœ‰çš„æ­£ç¡®å·¥ä½œçš„å·¥å…·
4. å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç§»é™¤è°ƒè¯•ä¿¡æ¯ä»¥å‡å°‘æ—¥å¿—è¾“å‡º

è¿™ä¸ªä¿®å¤ç¡®ä¿äº†å·¥å…·æ‰§è¡Œç»“æœçš„çŠ¶æ€æ˜¾ç¤ºä¸å®é™…æ‰§è¡Œç»“æœä¿æŒä¸€è‡´ï¼Œæå‡äº†ç”¨æˆ·ä½“éªŒçš„å‡†ç¡®æ€§ã€‚
