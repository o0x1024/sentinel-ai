# CTF角色提示词使用说明

## 📁 文件结构

```
roles/
├── ctfer.md           (810行, 22KB) - 完整版，包含所有知识
├── ctfer-base.md      (148行, 5KB)  - 基础版，核心流程和思维模式
├── ctfer-sqli.md      (356行, 9KB)  - SQL注入专项知识库
└── ctfer-upload.md    (380行, 10KB) - 文件上传专项知识库 (⚠️强调Cookie重要性)
```

## 💰 Token消耗对比

### 方案1: 使用完整版 (ctfer.md)
```
文件大小: 19,403 字符
估算token: ~6,000 tokens
单次成本: $0.018 (约0.12元)
10次调用: $0.18 (约1.2元)
```

### 方案2: 使用模块化 (ctfer-base.md + ctfer-sqli.md)
```
基础版: 5,062 字符 (~1,500 tokens)
SQL专项: 9,127 字符 (~2,700 tokens)
合计: 14,189 字符 (~4,200 tokens)

单次成本: $0.013 (约0.09元)
10次调用: $0.13 (约0.87元)

节省: 30% tokens, 30% 成本
```

### 方案3: 仅使用基础版 (ctfer-base.md)
```
文件大小: 5,062 字符
估算token: ~1,500 tokens
单次成本: $0.0045 (约0.03元)
10次调用: $0.045 (约0.3元)

节省: 75% tokens, 75% 成本
```

## 🎯 使用建议

### 场景1: SQL注入题目
**推荐**: `ctfer-base.md` + `ctfer-sqli.md`
- 包含完整的SQL注入知识
- 节省30%的token
- 响应速度更快

### 场景2: 文件上传题目
**推荐**: `ctfer-base.md` + `ctfer-upload.md`
- ⚠️ 特别强调Cookie/Session的重要性
- 完整的上传绕过技巧和利用流程
- 包含常见错误和解决方案

### 场景3: 其他Web漏洞
**推荐**: `ctfer.md` (完整版)
- 包含XSS、SSTI、命令注入等所有知识
- 一次性加载，无需切换

### 场景4: 快速测试/简单题目
**推荐**: `ctfer-base.md` (基础版)
- 只包含核心流程和思维模式
- 节省75%的token
- 适合快速判断和简单题目

## 📊 性能对比

| 指标 | 完整版 | 模块化 | 基础版 |
|------|--------|--------|--------|
| Token数 | ~6,000 | ~4,200 | ~1,500 |
| 成本/次 | $0.018 | $0.013 | $0.0045 |
| 响应速度 | 慢 | 中 | 快 |
| 知识完整性 | 100% | 70% | 30% |
| 适用场景 | 所有题型 | SQL注入 | 简单题目 |

## 🚀 最佳实践

### 策略1: 渐进式加载
```
1. 首先使用 ctfer-base.md 快速判断题型
2. 如果是SQL注入，加载 ctfer-sqli.md
3. 如果是其他漏洞，切换到 ctfer.md
```

### 策略2: 题型优先
```
- SQL注入题 → ctfer-base.md + ctfer-sqli.md (节省30% token)
- 其他题型 → ctfer.md (完整知识)
- 简单题目 → ctfer-base.md (节省75% token)
```

### 策略3: 成本优先
```
1. 始终使用 ctfer-base.md
2. 遇到复杂场景时，再切换到专项或完整版
3. 可节省平均50-70%的token成本
```

## 💡 实施建议

### 短期方案 (立即可用)
继续使用 `ctfer.md` 完整版，优点：
- ✅ 无需修改现有代码
- ✅ 知识最完整
- ✅ 适用所有场景

缺点：
- ❌ Token消耗较高
- ❌ 响应速度较慢

### 长期方案 (推荐)
实现智能加载机制：
```typescript
function selectPrompt(taskDescription: string) {
  if (taskDescription.includes('SQL') || taskDescription.includes('注入')) {
    return loadPrompts(['ctfer-base.md', 'ctfer-sqli.md']);
  } else if (taskDescription.includes('XSS')) {
    return loadPrompts(['ctfer-base.md', 'ctfer-xss.md']);
  } else {
    return loadPrompts(['ctfer.md']); // 完整版作为fallback
  }
}
```

优点：
- ✅ 节省30-75%的token
- ✅ 响应速度更快
- ✅ 可扩展性强

## 📈 预期收益

假设每天解10道CTF题：

### 当前方案 (完整版)
```
日消耗: 60,000 tokens
月消耗: 1,800,000 tokens
月成本: $5.4 (约36元)
```

### 优化方案 (模块化)
```
日消耗: 42,000 tokens (假设70%是SQL注入)
月消耗: 1,260,000 tokens
月成本: $3.78 (约25元)

月节省: $1.62 (约11元)
年节省: $19.44 (约130元)
```

### 激进方案 (基础版为主)
```
日消耗: 15,000 tokens (假设80%用基础版)
月消耗: 450,000 tokens
月成本: $1.35 (约9元)

月节省: $4.05 (约27元)
年节省: $48.6 (约324元)
```

## 🔧 实施步骤

### 步骤1: 测试模块化版本
1. 使用 `ctfer-base.md` + `ctfer-sqli.md` 解决几道SQL注入题
2. 对比效果和响应速度
3. 评估知识完整性是否满足需求

### 步骤2: 创建其他专项模块
```
- ctfer-xss.md (XSS专项)
- ctfer-command.md (命令注入专项)
- ctfer-ssti.md (SSTI专项)
- ctfer-file.md (文件漏洞专项)
- ctfer-bypass.md (绕过技巧集合)
```

### 步骤3: 实现智能加载
在应用代码中实现题型识别和动态加载机制

### 步骤4: 监控和优化
- 记录每种方案的实际效果
- 根据数据调整策略
- 持续优化知识库内容

## 📝 总结

**当前提示词确实存在token消耗过多的问题**，但这是可以优化的：

1. **短期**: 继续使用完整版，成本可接受
2. **中期**: 使用模块化方案，节省30%成本
3. **长期**: 实现智能加载，节省50-75%成本

**建议**: 先使用模块化方案测试效果，如果满意再实施智能加载机制。
