# LLM Compiler ä»»åŠ¡æ‰§è¡Œå¤±è´¥é—®é¢˜ä¿®å¤

## ğŸ“‹ é—®é¢˜æè¿°

æ—¥æœŸï¼š2025-11-13  
ä»»åŠ¡ï¼šæ‰«æ 3 ä¸ªç›®æ ‡çš„å¸¸è§ç«¯å£çŠ¶æ€  
ç»“æœï¼šæ‰€æœ‰ä»»åŠ¡å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ "Missing required parameter: target"

## ğŸ” é—®é¢˜åˆ†æ

### ç—‡çŠ¶

```
ERROR: Parameter validation failed for tool 'port_scan': Missing required parameter: target
INFO: è°ƒç”¨å·¥å…·: port_scan with inputs: {}  // âŒ å‚æ•°ä¸ºç©ºï¼
```

### æ ¹æœ¬åŸå› 

**å­—æ®µåä¸åŒ¹é…**ï¼šè§£æä»£ç ä¸ Prompt æ¨¡æ¿ä¸­çš„ JSON æ ¼å¼ä¸ä¸€è‡´

| ç»„ä»¶ | æœŸæœ›å­—æ®µå | å®é™…ä½¿ç”¨ | ç»“æœ |
|------|-----------|---------|------|
| Prompt æ¨¡æ¿ | `task_id`, `arguments` | LLM ç”Ÿæˆ | âœ… æ­£ç¡® |
| è§£æä»£ç  | `id`, `inputs` | è¯»å–å­—æ®µ | âŒ è¯»å–å¤±è´¥ |

### é—®é¢˜ç»†èŠ‚

**LLM ç”Ÿæˆçš„ JSON**ï¼ˆåŸºäº Prompt æ¨¡æ¿ï¼‰:
```json
{
  "task_id": "scan_97",           // âœ… ä½¿ç”¨ task_id
  "tool_name": "port_scan",
  "arguments": {                  // âœ… ä½¿ç”¨ arguments
    "target": "172.28.32.97",
    "ports": "80,443,22,3306"
  }
}
```

**æ—§çš„è§£æä»£ç ** (`planner.rs:518-531`):
```rust
id: node["id"]                    // âŒ è¯»å– "id"ï¼ˆä¸å­˜åœ¨ï¼‰
    .as_str()
    .unwrap_or(&format!("task_{}", index + 1))  // é€€å›åˆ° task_1
    .to_string(),
inputs: node["inputs"]            // âŒ è¯»å– "inputs"ï¼ˆä¸å­˜åœ¨ï¼‰
    .as_object()
    .cloned()
    .unwrap_or_default()          // é€€å›åˆ°ç©º HashMap {}
```

**ç»“æœé“¾**:
1. âŒ `node["id"]` ä¸å­˜åœ¨ â†’ ä½¿ç”¨é»˜è®¤å€¼ `task_1`
2. âš ï¸  `task_id` æ˜ å°„è­¦å‘Šï¼š`scan_97` â†’ `task_1`
3. âŒ `node["inputs"]` ä¸å­˜åœ¨ â†’ ä½¿ç”¨ç©ºå¯¹è±¡ `{}`
4. âŒ å·¥å…·è°ƒç”¨ç¼ºå°‘å¿…éœ€å‚æ•° â†’ æ‰§è¡Œå¤±è´¥

## âœ… ä¿®å¤æ–¹æ¡ˆ

### ä¿®æ”¹æ–‡ä»¶

`src-tauri/src/engines/llm_compiler/planner.rs`

### ä¿®æ”¹å†…å®¹

```rust
// âœ… åŒæ—¶æ”¯æŒ task_id å’Œ idï¼ˆä¼˜å…ˆ task_idï¼‰
id: node["task_id"]
    .as_str()
    .or_else(|| node["id"].as_str())
    .unwrap_or(&format!("task_{}", index + 1))
    .to_string(),

// âœ… åŒæ—¶æ”¯æŒ arguments å’Œ inputsï¼ˆä¼˜å…ˆ argumentsï¼‰
inputs: node["arguments"]
    .as_object()
    .or_else(|| node["inputs"].as_object())
    .cloned()
    .unwrap_or_default()
    .into_iter()
    .collect(),
```

### ä¿®å¤é€»è¾‘

1. **ä»»åŠ¡ ID**: ä¼˜å…ˆè¯»å– `task_id`ï¼Œå›é€€åˆ° `id`
2. **å‚æ•°**: ä¼˜å…ˆè¯»å– `arguments`ï¼Œå›é€€åˆ° `inputs`
3. **å…¼å®¹æ€§**: æ”¯æŒæ–°æ—§ä¸¤ç§æ ¼å¼ï¼Œä¿è¯å‘å‰å…¼å®¹

## ğŸ¯ é¢„æœŸæ•ˆæœ

ä¿®å¤åï¼Œä»»åŠ¡æ‰§è¡Œæµç¨‹ï¼š

```
LLM ç”Ÿæˆ JSON
  â†“
  task_id: "scan_97"
  arguments: { target: "172.28.32.97", ports: "80,443,22,3306" }
  â†“
è§£æå™¨è¯»å–
  â†“
  id: "scan_97"              âœ… æ­£ç¡®æ˜ å°„
  inputs: { ... }            âœ… å‚æ•°å®Œæ•´
  â†“
å·¥å…·æ‰§è¡Œ
  â†“
  port_scan(target="172.28.32.97", ports="80,443,22,3306")  âœ… æˆåŠŸ
```

## ğŸ“ æ•™è®­

### è®¾è®¡åŸåˆ™

1. **ä¸€è‡´æ€§**: Prompt æ¨¡æ¿å’Œè§£æä»£ç å¿…é¡»ä½¿ç”¨ç›¸åŒçš„å­—æ®µå
2. **å…¼å®¹æ€§**: è§£æå™¨åº”æ”¯æŒå¤šç§å­—æ®µåæ ¼å¼ï¼Œæä¾›å›é€€æœºåˆ¶
3. **éªŒè¯**: æ·»åŠ æ—¥å¿—è®°å½•ï¼Œæ–¹ä¾¿å¿«é€Ÿå®šä½å­—æ®µæ˜ å°„é—®é¢˜

### ä»£ç å®¡æŸ¥æ£€æŸ¥ç‚¹

- [ ] Prompt æ¨¡æ¿ä¸­å®šä¹‰çš„ JSON æ ¼å¼
- [ ] è§£æä»£ç ä¸­è¯»å–çš„å­—æ®µå
- [ ] å­—æ®µåæ˜¯å¦å®Œå…¨åŒ¹é…
- [ ] æ˜¯å¦æœ‰å›é€€æœºåˆ¶ï¼ˆå‘åå…¼å®¹ï¼‰
- [ ] æ˜¯å¦æœ‰æ—¥å¿—è®°å½•å…³é”®æ˜ å°„

## ğŸ”— ç›¸å…³æ–‡ä»¶

- `src-tauri/src/engines/llm_compiler/planner.rs` - DAG è®¡åˆ’è§£æå™¨
- `src-tauri/src/engines/llm_compiler/types.rs` - æ•°æ®ç»“æ„å®šä¹‰
- `docs/llm_compiler_prompts.sql` - Prompt æ¨¡æ¿å®šä¹‰

## âœ… éªŒè¯æ¸…å•

- [x] ç¼–è¯‘é€šè¿‡
- [ ] åŠŸèƒ½æµ‹è¯•ï¼šæ‰§è¡Œç›¸åŒçš„ç«¯å£æ‰«æä»»åŠ¡
- [ ] éªŒè¯å‚æ•°æ­£ç¡®ä¼ é€’
- [ ] éªŒè¯ä»»åŠ¡ ID æ­£ç¡®æ˜ å°„
- [ ] éªŒè¯å·¥å…·æˆåŠŸæ‰§è¡Œ

