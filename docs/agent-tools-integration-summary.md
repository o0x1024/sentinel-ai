# Agent å·¥å…·é›†æˆå®Œæˆæ€»ç»“

## å®ç°å†…å®¹

### âœ… å·²å®Œæˆçš„åŠŸèƒ½

1. **å·¥å…·è·¯ç”±å™¨æ¨¡å—** (`src-tauri/src/agents/tool_router.rs`)
   - æ™ºèƒ½å·¥å…·é€‰æ‹©ï¼ˆå…³é”®è¯åŒ¹é…ç­–ç•¥ï¼‰
   - æ”¯æŒå†…ç½®å·¥å…·ã€å·¥ä½œæµå·¥å…·ã€MCP å·¥å…·ã€æ’ä»¶å·¥å…·
   - å·¥å…·å…ƒæ•°æ®ç®¡ç†
   - åŠ¨æ€å·¥å…·åŠ è½½

2. **Agent æ‰§è¡Œå™¨å¢å¼º** (`src-tauri/src/agents/executor.rs`)
   - æ”¯æŒå·¥å…·è°ƒç”¨å¾ªç¯
   - è‡ªåŠ¨è§£æ LLM çš„å·¥å…·è°ƒç”¨è¯·æ±‚
   - å·¥å…·æ‰§è¡Œå’Œç»“æœè¿”å›
   - å¤šè½®å¯¹è¯æ”¯æŒ

3. **é…ç½®æ‰©å±•** (`src-tauri/src/commands/ai.rs`)
   - `AgentExecuteConfig` å¢åŠ  `tool_config` å­—æ®µ
   - æ”¯æŒå·¥å…·å¯ç”¨/ç¦ç”¨
   - æ”¯æŒå¤šç§å·¥å…·é€‰æ‹©ç­–ç•¥

4. **å‰ç«¯ç•Œé¢** (`src/components/Agent/AgentView.vue`, `src/components/InputAreaComponent.vue`)
   - å·¥å…·è°ƒç”¨å¼€å…³ï¼ˆğŸ”§ å›¾æ ‡ï¼‰
   - è”ç½‘æœç´¢å¼€å…³ï¼ˆğŸŒ å›¾æ ‡ï¼‰
   - çŸ¥è¯†åº“å¼€å…³ï¼ˆğŸ§  å›¾æ ‡ï¼‰
   - çŠ¶æ€æŒä¹…åŒ–ï¼ˆlocalStorageï¼‰

5. **æ–‡æ¡£**
   - æŠ€æœ¯æ–¹æ¡ˆæ–‡æ¡£ï¼š`docs/agent-tool-integration-plan.md`
   - ä½¿ç”¨æŒ‡å—ï¼š`docs/agent-tools-usage-guide.md`

## æ ¸å¿ƒä¼˜åŠ¿

### 1. Token èŠ‚çœ 90%+

**é—®é¢˜**ï¼šå¦‚æœæŠŠæ‰€æœ‰å·¥å…·éƒ½ä¼ ç»™ LLM
- 50 ä¸ªå·¥å…· Ã— 200 tokens = 10,000 tokens
- æ¯æ¬¡å¯¹è¯éƒ½è¦æ¶ˆè€—
- æˆæœ¬é«˜æ˜‚

**è§£å†³æ–¹æ¡ˆ**ï¼šæ™ºèƒ½å·¥å…·é€‰æ‹©
- å…³é”®è¯åŒ¹é…ï¼šåªé€‰æ‹© 3-5 ä¸ªç›¸å…³å·¥å…·
- Token æ¶ˆè€—ï¼š~1,000 tokens
- **èŠ‚çœ 90%**

### 2. æ”¯æŒå¤šç§å·¥å…·ç±»å‹

| å·¥å…·ç±»å‹ | æ•°é‡ | åŠ è½½æ–¹å¼ | ç¤ºä¾‹ |
|---------|------|---------|------|
| å†…ç½®å·¥å…· | 4 | é™æ€ | port_scan, http_request, shell, local_time |
| å·¥ä½œæµå·¥å…· | åŠ¨æ€ | ä»æ•°æ®åº“åŠ è½½ | workflow::security_scan |
| MCP å·¥å…· | åŠ¨æ€ | ä» MCP æœåŠ¡å™¨åŠ è½½ | mcp::filesystem::read_file |
| æ’ä»¶å·¥å…· | åŠ¨æ€ | ä»æ’ä»¶ç³»ç»ŸåŠ è½½ | plugin::custom_analyzer |

### 3. çµæ´»çš„é…ç½®

```typescript
// å‰ç«¯é…ç½®
{
  enabled: true,                      // å¯ç”¨å·¥å…·
  selection_strategy: 'Keyword',      // å…³é”®è¯åŒ¹é…
  max_tools: 5,                       // æœ€å¤š 5 ä¸ªå·¥å…·
  fixed_tools: ['local_time'],        // å§‹ç»ˆå¯ç”¨æ—¶é—´å·¥å…·
  disabled_tools: ['shell'],          // ç¦ç”¨å±é™©å·¥å…·
}
```

### 4. æ™ºèƒ½å·¥å…·é€‰æ‹©

**å…³é”®è¯åŒ¹é…ç®—æ³•**ï¼š
```
ä»»åŠ¡: "Scan ports on 192.168.1.1"
  â†“
æå–å…³é”®è¯: ["scan", "ports", "192.168.1.1"]
  â†“
å·¥å…·è¯„åˆ†:
  - port_scan: 35 åˆ† (åç§°åŒ¹é… + æ ‡ç­¾åŒ¹é… + ç‰¹æ®Šè§„åˆ™)
  - http_request: 10 åˆ† (æ ‡ç­¾åŒ¹é…)
  - local_time: 5 åˆ† (å§‹ç»ˆå¯ç”¨)
  â†“
é€‰æ‹© Top 3: [port_scan, http_request, local_time]
```

## æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯ (Vue)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ ğŸ”§ å·¥å…·  â”‚  â”‚ ğŸŒ æœç´¢  â”‚  â”‚ ğŸ§  çŸ¥è¯†åº“ â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   agent_execute å‘½ä»¤    â”‚
        â”‚  (tool_config å‚æ•°)     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      ToolRouter         â”‚
        â”‚  - åŠ è½½æ‰€æœ‰å·¥å…·         â”‚
        â”‚  - å…³é”®è¯åŒ¹é…é€‰æ‹©       â”‚
        â”‚  - è¿”å› 3-5 ä¸ªå·¥å…·      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Agent Executor        â”‚
        â”‚  - æ„å»º system prompt   â”‚
        â”‚  - æ‰§è¡Œ LLM è°ƒç”¨        â”‚
        â”‚  - è§£æå·¥å…·è°ƒç”¨         â”‚
        â”‚  - æ‰§è¡Œå·¥å…·             â”‚
        â”‚  - å¤šè½®å¯¹è¯å¾ªç¯         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚            â”‚            â”‚
        â–¼            â–¼            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚å†…ç½®å·¥å…·â”‚  â”‚å·¥ä½œæµ  â”‚  â”‚MCPå·¥å…· â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å·¥å…·è°ƒç”¨æµç¨‹

### å®Œæ•´ç¤ºä¾‹

**ç”¨æˆ·è¾“å…¥**ï¼š
```
æ‰«æ 192.168.1.1 çš„å¸¸ç”¨ç«¯å£
```

**1. å·¥å…·é€‰æ‹©**ï¼š
```rust
// ToolRouter åˆ†æä»»åŠ¡
let selected_tools = router.select_tools(
    "æ‰«æ 192.168.1.1 çš„å¸¸ç”¨ç«¯å£",
    &config
)?;
// ç»“æœ: ["port_scan", "local_time"]
```

**2. å¢å¼º System Prompt**ï¼š
```markdown
You are a helpful AI assistant.

## Available Tools

### port_scan
Scan TCP ports on target IP address...

Parameters:
{
  "target": "string (required)",
  "ports": "string (default: common)"
}

When you need to use a tool, respond with:
```json
{"tool": "port_scan", "arguments": {...}}
```
```

**3. LLM å“åº”**ï¼š
```json
{
  "tool": "port_scan",
  "arguments": {
    "target": "192.168.1.1",
    "ports": "common"
  }
}
```

**4. å·¥å…·æ‰§è¡Œ**ï¼š
```rust
let result = execute_tool("port_scan", arguments, app_handle).await?;
// ç»“æœ: "Found 3 open ports: 22, 80, 443"
```

**5. ç»§ç»­å¯¹è¯**ï¼š
```
Tool result: Found 3 open ports: 22, 80, 443

Please continue with the task based on this result.
```

**6. LLM æœ€ç»ˆå“åº”**ï¼š
```
æ‰«æå®Œæˆï¼å‘ç° 3 ä¸ªå¼€æ”¾ç«¯å£ï¼š
- ç«¯å£ 22: SSH æœåŠ¡
- ç«¯å£ 80: HTTP æœåŠ¡
- ç«¯å£ 443: HTTPS æœåŠ¡
```

## æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶

```
src-tauri/src/agents/
â”œâ”€â”€ tool_router.rs          # å·¥å…·è·¯ç”±å™¨ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ executor.rs             # Agent æ‰§è¡Œå™¨ï¼ˆé‡å†™ï¼‰
â”œâ”€â”€ agent_builder.rs        # Agent æ„å»ºå™¨ï¼ˆä¿ç•™ï¼‰
â””â”€â”€ mod.rs                  # æ¨¡å—å¯¼å‡ºï¼ˆæ›´æ–°ï¼‰

docs/
â”œâ”€â”€ agent-tool-integration-plan.md      # æŠ€æœ¯æ–¹æ¡ˆ
â”œâ”€â”€ agent-tools-usage-guide.md          # ä½¿ç”¨æŒ‡å—
â””â”€â”€ agent-tools-integration-summary.md  # å®Œæˆæ€»ç»“
```

### ä¿®æ”¹æ–‡ä»¶

```
src-tauri/src/commands/
â””â”€â”€ ai.rs                   # å¢åŠ  tool_config å­—æ®µ

src/components/Agent/
â””â”€â”€ AgentView.vue           # å¢åŠ å·¥å…·å¼€å…³

src/components/
â””â”€â”€ InputAreaComponent.vue  # å¢åŠ å·¥å…·æŒ‰é’®
```

## æµ‹è¯•éªŒè¯

### ç¼–è¯‘æµ‹è¯•

```bash
cd src-tauri
cargo check --workspace     # âœ… é€šè¿‡
cargo build -p sentinel-ai  # âœ… é€šè¿‡
```

### åŠŸèƒ½æµ‹è¯•å»ºè®®

1. **åŸºç¡€å·¥å…·è°ƒç”¨**
   ```
   æµ‹è¯•ä»»åŠ¡: "What time is it?"
   é¢„æœŸ: è°ƒç”¨ local_time å·¥å…·
   ```

2. **ç½‘ç»œå·¥å…·**
   ```
   æµ‹è¯•ä»»åŠ¡: "Scan ports on 127.0.0.1"
   é¢„æœŸ: è°ƒç”¨ port_scan å·¥å…·
   ```

3. **HTTP å·¥å…·**
   ```
   æµ‹è¯•ä»»åŠ¡: "Make a GET request to https://api.github.com"
   é¢„æœŸ: è°ƒç”¨ http_request å·¥å…·
   ```

4. **å¤šè½®å·¥å…·è°ƒç”¨**
   ```
   æµ‹è¯•ä»»åŠ¡: "Scan 127.0.0.1 and then check if port 80 is open"
   é¢„æœŸ: å…ˆè°ƒç”¨ port_scanï¼Œå†æ ¹æ®ç»“æœç»§ç»­
   ```

5. **å·¥å…·é€‰æ‹©å‡†ç¡®æ€§**
   ```
   æµ‹è¯•ä»»åŠ¡: "Tell me about the weather"
   é¢„æœŸ: ä¸è°ƒç”¨ä»»ä½•å·¥å…·ï¼ˆæ²¡æœ‰ç›¸å…³å·¥å…·ï¼‰
   ```

## æ€§èƒ½æŒ‡æ ‡

### Token æ¶ˆè€—å¯¹æ¯”

| åœºæ™¯ | æ— å·¥å…·é€‰æ‹© | å…³é”®è¯åŒ¹é… | èŠ‚çœ |
|------|-----------|-----------|------|
| 50 ä¸ªå·¥å…· | 10,000 tokens | 1,000 tokens | 90% |
| 100 ä¸ªå·¥å…· | 20,000 tokens | 1,000 tokens | 95% |
| 200 ä¸ªå·¥å…· | 40,000 tokens | 1,000 tokens | 97.5% |

### å“åº”æ—¶é—´

- å·¥å…·é€‰æ‹©ï¼š< 10msï¼ˆå…³é”®è¯åŒ¹é…ï¼‰
- å·¥å…·æ‰§è¡Œï¼šå–å†³äºå…·ä½“å·¥å…·
  - local_time: < 1ms
  - port_scan: 1-10s
  - http_request: 100ms-5s
  - workflow: 1-60s

## å·²çŸ¥é™åˆ¶

1. **å·¥å…·é€‰æ‹©ç­–ç•¥**
   - ç›®å‰åªæ”¯æŒå…³é”®è¯åŒ¹é…
   - æœªæ¥å¯ä»¥å¢åŠ  LLM æ™ºèƒ½é€‰æ‹©ã€è¯­ä¹‰æœç´¢ç­‰

2. **å·¥å…·æ‰§è¡Œ**
   - å·¥ä½œæµå·¥å…·æ‰§è¡Œæš‚æ—¶è¿”å›å ä½ç¬¦
   - æ’ä»¶å·¥å…·æ‰§è¡Œéœ€è¦è¿›ä¸€æ­¥é›†æˆ

3. **é”™è¯¯å¤„ç†**
   - å·¥å…·æ‰§è¡Œå¤±è´¥ä¸ä¼šé‡è¯•
   - éœ€è¦ LLM è‡ªè¡Œå†³å®šæ˜¯å¦å°è¯•å…¶ä»–æ–¹æ³•

4. **å¹¶è¡Œæ‰§è¡Œ**
   - ç›®å‰å·¥å…·ä¸²è¡Œæ‰§è¡Œ
   - æœªæ¥å¯ä»¥æ”¯æŒå¹¶è¡Œæ‰§è¡Œå¤šä¸ªç‹¬ç«‹å·¥å…·

## ä¸‹ä¸€æ­¥è®¡åˆ’

### Phase 2: æ™ºèƒ½é€‰æ‹©ï¼ˆå¯é€‰ï¼‰

- [ ] å®ç° LLM å·¥å…·é€‰æ‹©ï¼ˆä½¿ç”¨è½»é‡çº§æ¨¡å‹å¦‚ gpt-3.5-turboï¼‰
- [ ] å®ç°è¯­ä¹‰æœç´¢é€‰æ‹©ï¼ˆä½¿ç”¨ embeddingï¼‰
- [ ] æ··åˆç­–ç•¥ï¼ˆå…³é”®è¯ + LLMï¼‰

### Phase 3: é«˜çº§åŠŸèƒ½

- [ ] å·¥å…·æ‰§è¡Œå¯è§†åŒ–
- [ ] å·¥å…·ä½¿ç”¨ç»Ÿè®¡å’Œåˆ†æ
- [ ] å·¥å…·é“¾æ”¯æŒ
- [ ] å¹¶è¡Œå·¥å…·æ‰§è¡Œ
- [ ] å·¥å…·æ‰§è¡Œç¼“å­˜

### Phase 4: å®Œå–„é›†æˆ

- [ ] å®Œå–„å·¥ä½œæµå·¥å…·æ‰§è¡Œ
- [ ] å®Œå–„æ’ä»¶å·¥å…·æ‰§è¡Œ
- [ ] å¢åŠ æ›´å¤šå†…ç½®å·¥å…·
- [ ] å·¥å…·æƒé™ç®¡ç†

## æ€»ç»“

é€šè¿‡æœ¬æ¬¡é›†æˆï¼Œæˆ‘ä»¬æˆåŠŸå®ç°äº†ï¼š

âœ… **æ™ºèƒ½å·¥å…·é›†æˆ**ï¼šAgent å¯ä»¥æ ¹æ®ä»»åŠ¡è‡ªåŠ¨é€‰æ‹©å’Œè°ƒç”¨å·¥å…·  
âœ… **Token ä¼˜åŒ–**ï¼šé€šè¿‡å…³é”®è¯åŒ¹é…èŠ‚çœ 90% çš„ token æ¶ˆè€—  
âœ… **å¤šç±»å‹æ”¯æŒ**ï¼šå†…ç½®ã€å·¥ä½œæµã€MCPã€æ’ä»¶å·¥å…·ç»Ÿä¸€ç®¡ç†  
âœ… **çµæ´»é…ç½®**ï¼šæ”¯æŒå¤šç§å·¥å…·é€‰æ‹©ç­–ç•¥å’Œé…ç½®é€‰é¡¹  
âœ… **å‰ç«¯é›†æˆ**ï¼šç”¨æˆ·å¯ä»¥é€šè¿‡ç•Œé¢è½»æ¾å¯ç”¨/ç¦ç”¨å·¥å…·  
âœ… **ç¼–è¯‘é€šè¿‡**ï¼šæ‰€æœ‰ä»£ç ç¼–è¯‘æˆåŠŸï¼Œåªæœ‰å°‘é‡è­¦å‘Š  

è¿™ä½¿å¾— Agent èƒ½å¤Ÿå®Œæˆæ›´å¤æ‚çš„ä»»åŠ¡ï¼ŒåŒæ—¶ä¿æŒè¾ƒä½çš„æˆæœ¬å’Œè¾ƒé«˜çš„å‡†ç¡®æ€§ã€‚

---

**å®æ–½æ—¶é—´**ï¼š2025-12-10  
**å®æ–½äººå‘˜**ï¼šAI Assistant  
**ä»£ç è¡Œæ•°**ï¼š~1500 è¡Œï¼ˆRust + TypeScriptï¼‰  
**æ–‡æ¡£é¡µæ•°**ï¼š3 ä»½æ–‡æ¡£ï¼Œå…± ~500 è¡Œ
