# 工作流工作室待办清单

> 目标：删除现有工作流监控视图，改为类似 Dify/n8n 的可视化节点编排工作流；逐步落地，每完成一步更新本文档。

## 里程碑与任务

### 里程碑一：图模型与工作室骨架
- [x] 定义工作流图数据模型与端口类型
- [x] 设计节点库 catalog 接口与参数 schema
- [x] 创建工作室与运行历史路由骨架
- [x] 整合画布组件并实现基本拖拽
- [x] 草拟图校验规则与校验器接口
- [x] 删除工作流监控视图与菜单项

### 里程碑二：执行引擎与事件流
- [x] 适配执行引擎并定义接口契约
- [x] 规范事件回传并封装前端订阅
- [x] 设计运行记录表结构并持久化
- [x] 搭建运行历史页面骨架

### 里程碑三：节点生态打通
- [ ] 适配工具节点至统一管理器
- [ ] 接入 MCP 工具为节点
- [ ] 接入 RAG 与 Prompt 节点
- [ ] 设计并实现控制流节点策略

### 里程碑四：版本化与安全
- [ ] 设计版本发布与回滚策略
- [ ] 实现凭据与敏感信息保护
- [ ] 初步实现权限与审计
- [ ] 编写 E2E 测试用例与回归

## 文件与模块参考
- 移除菜单项：`src/components/Layout/Sidebar.vue:147`
- 旧视图：`src/views/WorkflowMonitor.vue`
- 画布组件参考：`src/components/FlowchartVisualization.vue:271`
- 执行引擎：`src-tauri/src/engines/intelligent_dispatcher/workflow_engine.rs:327`、`src-tauri/src/engines/intelligent_dispatcher/workflow_engine.rs:388`
- 任务队列：`src-tauri/src/engines/intelligent_dispatcher/task_queue.rs:143`
- 工具管理器：`src-tauri/src/tools/unified_manager.rs:392`
- MCP 工具接口：`src-tauri/src/commands/mcp.rs:999`
- 事件推送参考：`src-tauri/sentinel-passive/src/scanner.rs:48`
- 步骤数据结构：`src-tauri/sentinel-core/src/models/workflow.rs:1`

## 进度记录
- 2025-11-28
  - [x] 创建待办文档与初始化任务
  - [x] 完成工作流图数据模型与端口类型定义（`src/types/workflow.ts:1`、`src-tauri/src/models/workflow_graph.rs:1`、`src-tauri/src/models/mod.rs:12`）
  - [x] 设计并实现节点库 catalog 接口与参数 schema（`src-tauri/src/commands/workflow_catalog.rs:1`、`src-tauri/src/commands/mod.rs:1`、`src-tauri/src/lib.rs:501`）
  - [x] 创建工作室与运行历史路由骨架（`src/main.ts:100`、`src/views/WorkflowStudio.vue:1`、`src/views/WorkflowRuns.vue:1`）
  - [x] 整合画布组件并实现基本拖拽（点击节点库添加节点，`src/views/WorkflowStudio.vue:1`、`src/components/FlowchartVisualization.vue:699`）
  - [x] 草拟图校验规则与校验器接口（`src/types/workflow.ts:74`）
  - [x] 删除工作流监控视图与菜单项（替换菜单与路由，`src/components/Layout/Sidebar.vue:185`、`src/main.ts:137`）

## 更新说明
- 每完成一个任务，勾选对应复选框并追加变更记录；如涉及文件改动，补充路径与说明（使用 `file_path:line_number` 便于定位）。
  - [x] 适配执行引擎并定义接口契约（`src-tauri/src/engines/intelligent_dispatcher/mod.rs:1`、`src-tauri/src/engines/intelligent_dispatcher/workflow_engine.rs:220`、`src-tauri/src/lib.rs:409`）
  - [x] 规范事件回传并封装前端订阅（事件：`workflow:run-start`/`workflow:step-start`/`workflow:progress`/`workflow:step-complete`/`workflow:run-complete`，订阅封装：`src/composables/useWorkflowEvents.ts:1`，工作室订阅：`src/views/WorkflowStudio.vue:156`，运行历史订阅：`src/views/WorkflowRuns.vue:86`）
  - [x] 设计运行记录表结构并持久化（`src-tauri/sentinel-db/src/database_service.rs:1255`、`src-tauri/sentinel-db/src/database_service.rs:1279`、`src-tauri/sentinel-db/src/database_service.rs:4091`、`src-tauri/sentinel-db/src/database_service.rs:4160`）
  - [x] 搭建运行历史页面骨架与数据接入（`src/views/WorkflowRuns.vue:1`、`src-tauri/src/commands/workflow_run.rs:181`、`src-tauri/src/commands/mod.rs:1`、`src-tauri/src/lib.rs:830`）
