# 知识库引用检测 - 使用示例

## 快速开始

### 1. 准备知识库

首先需要在"知识库管理"页面创建并激活一个知识库集合：

1. 进入 **工具 → 知识库管理**
2. 创建新集合（例如："网络安全知识库"）
3. 上传相关文档（支持 PDF、TXT、MD 等格式）
4. 点击"激活"按钮激活该集合

### 2. 开启知识库功能

在AI助手对话界面：

1. 点击输入框工具栏中的 **🧠 图标**（知识检索增强）
2. 图标变为高亮状态表示已启用
3. 会话头部会显示 **📖 知识库** 标签

### 3. 进行对话

提问时，AI会自动从知识库中检索相关内容并引用：

**示例对话1：成功引用**
```
用户: 什么是SQL注入攻击？

AI: SQL注入是一种常见的Web应用安全漏洞 [SOURCE 1]。攻击者通过在输入字段中
插入恶意SQL代码，可以绕过应用程序的安全验证，直接操作数据库 [SOURCE 2]。

常见的防护措施包括：
1. 使用参数化查询或预编译语句 [SOURCE 1]
2. 对用户输入进行严格的验证和过滤 [SOURCE 3]
3. 使用最小权限原则配置数据库账户 [SOURCE 2]
```

**消息下方会显示：**
```
📖 已引用知识库 (3 处引用)
```

**示例对话2：无相关内容**
```
用户: 今天天气怎么样？

AI: 抱歉，我无法获取实时天气信息。我的知识库主要包含网络安全相关内容。
```

**消息下方会显示：**
```
📖 已启用知识库，但未找到相关内容
```

## 视觉效果

### 引用标记样式

AI回复中的 `[SOURCE n]` 会被高亮显示：

- **颜色**: 蓝色背景，蓝色边框
- **字体**: 等宽字体
- **交互**: 鼠标悬停时显示"知识库引用 #n"提示
- **动画**: 悬停时轻微上移和阴影效果

### 状态指示器

1. **会话头部**
   - 显示位置：会话标题右侧
   - 显示内容：📖 知识库
   - 显示条件：RAG功能已启用

2. **消息级别**
   - 显示位置：AI回复消息顶部
   - 显示内容：
     - 有引用：`📖 已引用知识库 (n 处引用)`
     - 无引用：`📖 已启用知识库，但未找到相关内容`
   - 显示条件：该消息使用了RAG功能

## 实际应用场景

### 场景1：安全漏洞分析

**知识库内容**: OWASP Top 10、CVE数据库、安全最佳实践

**对话示例**:
```
用户: 分析这个XSS漏洞的危害和修复方案

AI: 该XSS漏洞属于反射型跨站脚本攻击 [SOURCE 1]。主要危害包括：

1. 窃取用户Cookie和会话信息 [SOURCE 2]
2. 钓鱼攻击和页面篡改 [SOURCE 3]
3. 传播恶意软件 [SOURCE 1]

修复方案：
1. 对所有用户输入进行HTML实体编码 [SOURCE 4]
2. 实施内容安全策略(CSP) [SOURCE 5]
3. 使用HTTPOnly和Secure标志保护Cookie [SOURCE 2]
```

### 场景2：渗透测试指导

**知识库内容**: 渗透测试方法论、工具使用手册、合规要求

**对话示例**:
```
用户: 如何进行Web应用渗透测试？

AI: Web应用渗透测试通常遵循以下步骤 [SOURCE 1]：

1. 信息收集阶段
   - 识别目标系统架构和技术栈 [SOURCE 2]
   - 收集域名、IP、子域名等信息 [SOURCE 3]

2. 漏洞扫描阶段
   - 使用自动化工具进行初步扫描 [SOURCE 4]
   - 手工验证扫描结果 [SOURCE 1]

3. 漏洞利用阶段
   - 尝试利用发现的漏洞 [SOURCE 5]
   - 评估漏洞的实际影响 [SOURCE 6]

注意：所有测试必须获得书面授权 [SOURCE 7]
```

### 场景3：技术问题排查

**知识库内容**: 技术文档、故障排查指南、配置手册

**对话示例**:
```
用户: Burp Suite代理配置失败怎么办？

AI: Burp Suite代理配置失败的常见原因和解决方案 [SOURCE 1]：

1. 端口冲突
   - 检查8080端口是否被占用 [SOURCE 2]
   - 更换其他端口（如8081、8888）[SOURCE 3]

2. 浏览器代理设置
   - 确认浏览器代理指向127.0.0.1:8080 [SOURCE 4]
   - 检查是否安装了Burp CA证书 [SOURCE 5]

3. 防火墙拦截
   - 临时关闭防火墙测试 [SOURCE 6]
   - 添加Burp Suite到防火墙白名单 [SOURCE 2]
```

## 最佳实践

### 1. 知识库内容组织

- **分类清晰**: 按主题创建不同的集合
- **内容质量**: 确保文档准确、完整、最新
- **格式规范**: 使用标准格式（Markdown、PDF等）
- **定期更新**: 及时添加新的知识和案例

### 2. 提问技巧

- **具体明确**: 提供足够的上下文信息
- **关键词准确**: 使用知识库中存在的术语
- **分步提问**: 复杂问题可以拆分成多个小问题

### 3. 引用验证

- **检查引用**: 注意AI是否真的引用了知识库
- **评估相关性**: 引用的内容是否真正相关
- **交叉验证**: 重要信息可以要求提供更多引用

## 技术限制

### 当前限制

1. **检索范围**: 仅限已激活的知识库集合
2. **引用格式**: 固定为 `[SOURCE n]` 格式
3. **引用详情**: 暂不支持点击查看原文
4. **多语言**: 主要支持中文和英文

### 已知问题

1. **相似度阈值**: 过低可能检索到不相关内容
2. **上下文长度**: 超长文档可能被截断
3. **实时更新**: 新添加的文档需要重新索引

## 故障排查

### 问题1: 启用RAG后没有引用

**可能原因**:
- 知识库中没有相关内容
- 相似度阈值设置过高
- 查询关键词不匹配

**解决方案**:
1. 检查知识库内容是否包含相关主题
2. 调整RAG配置中的相似度阈值
3. 使用更准确的关键词重新提问

### 问题2: 引用内容不准确

**可能原因**:
- 文档质量问题
- 检索算法误判
- 上下文理解偏差

**解决方案**:
1. 改进知识库文档质量
2. 启用重排序功能提高准确性
3. 提供更多上下文信息

### 问题3: 性能问题

**可能原因**:
- 知识库过大
- 检索top_k设置过高
- 服务器资源不足

**解决方案**:
1. 优化知识库大小和结构
2. 降低top_k值（默认5）
3. 升级服务器配置

## 参考资料

- [RAG功能配置指南](./rag-configuration.md)
- [知识库管理文档](./knowledge-base-management.md)
- [AI助手使用手册](./ai-assistant-guide.md)
